<div class="container-fluid mt-3">
  <!-- CONFIRMACIÓN -->
  <div class="row d-flex justify-content-center text-center" *ngIf="botonComenzar">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body card-custom">
          <h4 class="fw-bold">Subir Archivos De Un Cliente</h4>
          <h5>A continuación, deberá Subir los Archivos en el Orden que Se le indiquen</h5>
          <button (click)="cambiarInputs('COMENZAR')" class="btn btn-consultar mt-3">Comenzar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- OBLIGACIONES -->
  <div class="row mt-3" *ngIf="botonCedula">
    <div class="col-md-4">
      <div class="card">
        <div class="card-body card-custom">
          <h5 class="fw-bold text-center">Digite La Cédula Del Cliente</h5>
          <div class="usuario mt-4">
            <input [(ngModel)]="cedula" name="cedula" type="text" class="input-usuario" placeholder="Número De Cédula">
          </div>
          <div class="row d-flex justify-content-center text-center">
            <div class="col-md-12">
              <button (click)="getObligacionByCedula()" class="btn btn-consultar">Consultar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-8 mt-3">
      <div class="card">
        <div class="card-body card-custom">
          <h5 class="fw-bold" *ngIf="obligacion.length > 0">Seleccione una Obligación</h5>
          <div class="mt-2 mb-2">
            <div *ngIf="obligacion.length == 0">
              <h5 class="text-center mt-4">Sin Obligaciones</h5>
            </div>
            <div class="table-responsive" *ngIf="obligacion.length > 0">
              <table class="table table-hover text-center mt-3">
                <thead>
                  <tr>
                    <th scope="col"># Obligación</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Valor Obligación</th>
                    <th scope="col">Fecha Obligación</th>
                    <th scope="col">Sede</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let o of obligacion; let i = index" (click)="numeroO(o.cuentaPorCobrar.numeroObligacion, 'CEDULA', i)"
                    style="cursor: pointer;">
                    <td>{{ o.cuentaPorCobrar.numeroObligacion }}</td>
                    <td>{{ o.cuentaPorCobrar.cliente.nombres }} {{ o.cuentaPorCobrar.cliente.apellidos }}</td>
                    <td>{{ o.cuentaPorCobrar.capital }}</td>
                    <td>{{ o.cuentaPorCobrar.fechaObligacion | date:'short' }}</td>
                    <td>{{ o.cuentaPorCobrar.sede.nombreSede }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row d-flex justify-content-center" *ngIf="!botonComenzar && !botonCedula">
    <div class="progress mt-2 mb-2" role="progressbar" aria-label="Example with label" aria-valuenow="20"
      aria-valuemin="0" aria-valuemax="100">
      <div class="progress-bar progress-bar-striped progress-bar-animated"
        [style]="{ 'width': width+'%', 'background-color': background_color, 'display': display }">{{ width }}%
      </div>
    </div>

    <!-- Cards Archivos -->
    <div class="col-md-6 mb-2">
      <div class="card card-custom">
        <div class="card-body">
          <div class="col-md-12 col-12">
            <select [(ngModel)]="tipoArchivo" name="tipoArchivo" (change)="selectArchivos($event)" class="form-select"
              [disabled]="disabledSelect">
              <option value="" selected>Seleccionar el Tipo de Archivo</option>
              <option *ngFor="let t of tiposArchivos" value="{{ t }}">{{t}}</option>
            </select>

            <div class="row text-center">
              <div class="col-md-6 col-6 d-block d-sm-none" *ngIf="cantidadArchivos == 0">
                <h6 class="fw-bold text-red">Tomar Fotos</h6>
                <span (click)="triggerFileInput('cameraInput')">
                  <i class="fa-solid fa-camera custom-icon"></i>
                </span>
              </div>
              <div class="col-md-12" [ngClass]="{'col-6': cantidadArchivos == 0, 'col-12': cantidadArchivos > 0}">
                <h6 class="fw-bold text-red">Seleccionar Archivos</h6>
                <span (click)="triggerFileInput('fileInput')">
                  <i class="fa-solid fa-folder-open custom-icon"></i>
                </span>
                <h6 class="fw-bold mt-3" *ngIf="cantidadArchivos > 0">{{ cantidadArchivos }} Archivo(s) Seleccionado(s)
                </h6>
              </div>
            </div>

            <div class="row mt-3">
              <div class="col-md-4 text-end">
                <button class="btn btn-lg btn-consultar" (click)="cargarArchivos()" [disabled]="disabledCargar">Cargar
                  archivo</button>
              </div>
              <div class="col-md-4 text-center">
                <button class="btn btn-lg btn-consultar" (click)="cancelarArchivos()"
                  [disabled]="disabledCargar">Cancelar</button>
              </div>
              <div class="col-md-4 text-start">
                <button class="btn btn-lg btn-reintentar" data-bs-toggle="modal" data-bs-target="#verArchivosModal"
                  [disabled]="disabledVer">Ver archivos</button>
              </div>
            </div>

            <!-- <input type="file" accept="application/pdf" capture="camera" id="cameraInput" class="d-none"
              (change)="obtenerFile($event)"> -->
            <input type="file" accept="application/pdf" #fileInput id="fileInput" class="d-none"
              (change)="obtenerFile($event)" multiple>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12 text-center">
        <button (click)="save()" class="boton">Guardar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="verArchivosModal" tabindex="-1" aria-labelledby="verArchivosModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="verArchivosModalLabel">Archivos Seleccionados</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div *ngFor="let archivo of archivosCargados; let i = index;" class="mb-3">
          <div class="card">
            <div class="card-body">
              <h6>TIPO ARCHIVO: {{ archivo.tipoArchivo }}</h6>
              <embed *ngIf="archivo.base64 != ''" type="application/pdf" [src]="archivo.base64" height="300px"
                style="width: 100%;">
              <div class="text-center mt-3">
                <button (click)="eliminarArchivos(archivo.tipoArchivo)" class="btn btn-danger">Eliminar</button>
              </div>
            </div>
          </div>
        </div>
        <span *ngIf="archivosCargados.length == 0">
          <h5 class="text-center">No hay archivos cargados.</h5>
        </span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>